;***********************************************************************************************
; 
; サブプロセス
; 
;***********************************************************************************************
;***********************************************************************************************
; 自動実行
;***********************************************************************************************
;-----------------------------------------------------------------------
; 初期化処理
;-----------------------------------------------------------------------
InitSub:
	#NoEnv
	#NoTrayIcon
	#Persistent
	#SingleInstance force
	#InstallKeybdHook
	#InstallMouseHook
	CoordMode, Mouse, Screen
	CoordMode, Caret, Screen
	CoordMode, Tooltip, Screen
	SetWorkingDir %A_ScriptDir%
	SetVolatileEnv()
	InitClipboard()
	InitPopupLauncher()
	InitClipboardHistory(100)
	InitTextBuffer()
return

;-----------------------------------------------------------------------
; 終了処理
;-----------------------------------------------------------------------
vk3B::
ExitApp

;***********************************************************************************************
; ポップアップランチャー
;***********************************************************************************************
;-----------------------------------------------------------------------
; カーソル位置
;-----------------------------------------------------------------------
vk07::
	GetCaretPos(cx, cy)
	ShowPopupLauncher(cx, cy)
return

;-----------------------------------------------------------------------
; マウス位置
;-----------------------------------------------------------------------
vk0E::
	MouseGetPos x, y
	ShowPopupLauncher(x, y)
return

;***********************************************************************************************
; テキストバッファ
;***********************************************************************************************
;-----------------------------------------------------------------------
; カーソル位置
;-----------------------------------------------------------------------
vk0F::
	GetCaretPos(cx, cy)
	ShowTextBuffer(cx, cy)
return

;-----------------------------------------------------------------------
; マウス位置
;-----------------------------------------------------------------------
vk16::
	MouseGetPos x, y
	ShowTextBuffer(x, y)
return

;***********************************************************************************************
; クリップボード履歴
;***********************************************************************************************
;-----------------------------------------------------------------------
; カーソル位置
;-----------------------------------------------------------------------
vk1A::
	GetCaretPos(cx, cy)
	ShowClipboardHistory(cx, cy)
return

;-----------------------------------------------------------------------
; マウス位置
;-----------------------------------------------------------------------
vk3A::
	MouseGetPos x, y
	ShowClipboardHistory(x, y)
return

;***********************************************************************************************
; 空き仮想キーコード
;***********************************************************************************************
vk3C::
vk3D::
vk3E::
vk3F::
vk40::
return

;***********************************************************************************************
; キャレット位置を取得する
;***********************************************************************************************
GetCaretPos(Byref cx, Byref cy) {
	if (A_CaretX > 0) {
		cx := A_CaretX
		cy := A_CaretY
	}
	else {
		WinGetPos, X, Y, Width, Height, A
		cx := X + (Width / 3)
		cy := Y + (Height / 2)
	}
}

;***********************************************************************************************
; インクルード
;***********************************************************************************************
#include Clipboard.ahk
#include PopupLauncher.ahk
#include ClipboardHistory.ahk
#include TextBuffer.ahk
#include WheelRedirect.ahk
#include TextFunctions.ahk
